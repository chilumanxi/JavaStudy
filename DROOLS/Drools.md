# Drools

## Drools内置方法

| 属性名  | 说明 |
| ------- | ---- |
| update  | 更新 |
| insert  | 添加 |
| retract | 删除 |



## attributes属性说明：

| 属性名           | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| salience         | 指定规则执行优先级，数值越大越优先执行，默认值为0，如果不设置salience属性，规则体的执行顺序为由上到下。 |
| dialect          | 指定规则使用的语言类型，取值为java和mvel，默认java           |
| enabled          | 指定规则是否启用，如果设置的值为false则当前规则无论是否匹配成功都不会触发 |
| date-effective   | 指定规则生效时间，即只有当前系统时间大于等于设置的时间或者日期规则才有可能触发 |
| date-expires     | 指定规则失效时间，只有当前系统时间小于设置的时间或者日期规则才有可能触发 |
| activation-group | 激活分组，具有相同分组名称的规则只能有一个规则触发           |
| agenda-group     | 议程分组，只有获取焦点的组中的规则才有可能触发,写法：kieSession.getAgenda().getAgendaGroup("agendaGroup").setFocus(); |
| timer            | 定时器，指定规则触发的时间                                   |
| auto-focus       | 自动获取焦点，一般结合agenda-group一起使用，当一个议程分组未获取焦点时，可以设置auto-focus属性来控制。 注意：同一个组，只要有个设置auto-focus true 其他的设置不设置都无所谓。都会起作用的 |
| no-loop          | 防止死循环                                                   |



## 完整规则文件内容构成：

| 关键字   | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| package  | 包名，只限于逻辑上的管理，同一个包名下的查询或者函数可以直接调用 |
| import   | 用于导入类或者静态方法                                       |
| global   | 用于在规则文件中**定义全局变量**，它可以让应用程序的对象在规则文件中能够被访问。可以用来为规则文件提供数据或服务。<br />1、如果对象类型为**包装类型**时，在一个规则中改变了global的值，那么**只针对当前规则有效**，对其他规则中的global不会有影响。可以理解为它是当前规则代码中的global副本，规则内部修改不会影响全局的使用。<br />2、如果对象类型为**集合类型或JavaBean**时，在一个规则中改变了global的值，对java代码和所有规则都有效。 |
| function | 自定义函数，就相当于java类中的方法一样。可以在规则体中调用定义的函数。使用函数的好处是可以将业务逻辑集中放置在一个地方，根据需要可以对函数进行修改。 |
| query    | query查询提供了一种**查询working memory中符合约束条件的Fact对象**的简单方法。它仅包含规则文件中的LHS部分，不用指定“when”和“then”部分并且以end结束。 |
| rule end | 规则体                                                       |



## LHS加强

| 关键字              | 描述                                                         |
| ------------------- | ------------------------------------------------------------ |
| 复合值限制in/not in | 复合值限制是指超过一种匹配值的限制条件，类似于SQL语句中的in关键字。Drools规则体中的LHS部分可以使用in或者not in进行复合值的匹配，具体用法如下：<br />$s:Student(name in ("张三","李四","王五")) <br />$s:Student(name not in ("张三","李四","王五")) |
| 条件元素eval        | eval用于规则体的LHS部分，并返回一个Boolean类型的值。语法结构如下：<br />eval(true)<br />eval(false)<br />eval(1 == 1) |
| 条件元素not/exists  | not用于判断Working Memory中是否存在某个Fact对象，如果不存在则返回true，如果存在则返回false。exists的作用与not相反，用于判断Working Memory中是否存在某个Fact对象，如果存在则返回true，不存在则返回false。语法结构如下：<br />not Student()<br />not Student(age < 10)<br />exists Student()<br />exists Student(age < 10 && name != null)<br />注意：和直接在LHS里写Fact元素不同的是，当向Working Memory中加入多个满足条件的Fact对象时，使用了exists的规则执行一次，不使用exists的规则会执行多次。 |
| 规则继承            | 规则之间可以使用extends关键字进行规则条件部分的继承，类似于java类之间的继承 |



## RHS加强

| 关键字           | 描述                                 |
| ---------------- | ------------------------------------ |
| halt             | 作用是**立即终止后面所有规则的执行** |
| getWorkingMemory | 作用是返回工作内存对象               |
| getRule          | 作用是返回规则对象                   |



## 编码规范

- 所有的规则文件(.drl)应统一放在一个规定的文件夹中，如：/rules文件夹
- 书写的每个规则应尽量加上注释。注释要清晰明了，言简意赅
- 同一类型的对象尽量放在一个规则文件中，如所有Customer类型的对象尽量放在一个规则文件中
- 规则结果部分(RHS)尽量不要有条件语句，如if(...)，尽量不要有复杂的逻辑和深层次的嵌套语句
- 每个规则最好都加上salience属性，明确执行顺序
- Drools默认dialect为"Java"，尽量避免使用dialect "mvel"

























模板模式：

优点：

1、利用模板方法将相同处理逻辑的代码放到抽象父类中，可以提高代码的复用性。

2、将不同的代码不同的子类中，通过对子类的扩展增加新的行为，提高代码的扩展性。

3、把不变的行为写在父类上，去除子类的重复代码，提供了一个很好的代码复用平台，符合开闭原则。
